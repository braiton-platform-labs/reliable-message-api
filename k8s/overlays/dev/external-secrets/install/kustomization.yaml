apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: external-secrets

resources:
  - namespace.yaml
  # Vendored/pinned manifest to avoid kustomize remote URL/git fetch failures.
  # Note: kept under this kustomization directory to satisfy kustomize load restrictor.
  - vendor/external-secrets.v0.18.2.yaml

patches:
  # The upstream "external-secrets.yaml" asset is generated for namespace "default".
  # When we install into "external-secrets", we must patch internal references (flags, webhook service namespace, CRB subjects).
  - path: patches/webhook-deployment.yaml
  - path: patches/cert-controller-deployment.yaml
  - path: patches/clusterrolebinding-controller.yaml
  - path: patches/clusterrolebinding-cert-controller.yaml
  - path: patches/validatingwebhook-secretstore.yaml
  - path: patches/validatingwebhook-externalsecret.yaml
